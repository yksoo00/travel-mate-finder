<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ê´€ê´‘ì§€ ë“±ë¡</title>

  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/navbar.css}">
  <link rel="stylesheet" th:href="@{/css/recruit.css}">
  <link rel="stylesheet" th:href="@{/css/tourist.css}">

  <link rel="stylesheet" th:href="@{/css/touristCreateForm.css}">

  <script type="text/javascript"
          src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8b23243ecce1d67f7d49784724586afa&libraries=services"></script>

</head>
<body>

<nav class="navbar" th:replace="~{navbar :: navbar}"></nav>

<div class="main-layout">

  <div class="map-container">
    <div class="recruit-page" id="map-page">
      <div class="recruit-header">
        <h1 class="recruit-title">ì¹´ì¹´ì˜¤ ë§µ</h1>
      </div>
      <div id="map-content">
        <div id="map"></div>
      </div>
    </div>
  </div>

  <div class="content-container">
    <div class="recruit-page" id="create-page">

      <div class="form-page-header">
        <h1 class="form-page-title">ê´€ê´‘ì§€ ë“±ë¡</h1>
      </div>

      <form id="tourist-create-form"
            action="/api/v1/tourist-spots"
            method="post">

        <div class="form-group">
          <label for="district" class="form-label">ì§€ì—­</label>
          <input type="text" id="district" name="district" class="form-control"
                 placeholder="ì˜ˆ: ìˆ˜ë„ê¶Œ" required>
        </div>

        <div class="form-group">
          <label for="title" class="form-label">ê´€ê´‘ì§€ëª…</label>
          <input type="text" id="title" name="title" class="form-control"
                 placeholder="ì˜ˆ: ê²½ë³µê¶" required>
        </div>

        <div class="form-group">
          <label for="description" class="form-label">ì„¤ëª…</label>
          <textarea id="description" name="description" class="form-control" rows="5"
                    placeholder="ì´ ê´€ê´‘ì§€ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
        </div>

        <div class="form-group">
          <label for="map-address-display" class="form-label">ì£¼ì†Œ (ê´€ê´‘ì§€ ì„ íƒ)</label>
          <input type="text" id="map-address-display" class="form-control" disabled
                 placeholder="ì§€ë„ì—ì„œ ê´€ê´‘ì§€ë¥¼ í´ë¦­í•˜ë©´ ìë™ ì…ë ¥ë©ë‹ˆë‹¤.">
        </div>

        <!-- touristSpotId ê°’ì„ ìˆ¨ê²¨ì„œ ì €ì¥ -->
        <input type="hidden" id="touristSpotId">

        <div class="form-group">
          <label for="phone" class="form-label">ì „í™”ë²ˆí˜¸</label>
          <input type="text" id="phone" name="phone" class="form-control"
                 placeholder="ì˜ˆ: 02-123-4567">
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit">Register</button>
          <a href="/tourist/touristListPage" class="btn-cancel">Cancel</a>
        </div>
      </form>

    </div>
  </div>
</div>
<script th:src="@{/js/map.js}"></script>

<script th:src="@{/js/mapClickToAddress.js}"></script>

<script>
  document.getElementById('tourist-create-form').addEventListener('submit', async function (event) {

    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);
    const actionUrl = form.action;   // â†’ "/api/v1/tourist-spots"

    try {
      // ğŸ”µ fetch â†’ apiFetch ë¡œ ë³€ê²½ (FormData ìë™ ì²˜ë¦¬)
      const response = await apiFetch(actionUrl, {
        method: "POST",
        body: formData   // â† FormDataì¼ ë•Œ Content-Type ìë™ ì ìš© X
      });

      if (!response.ok) {
        throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");
      }

      const data = await response.json();

      alert(data.message);

      const newSpotId = data.data;
      window.location.href = "/tourist/touristDetail?id=" + newSpotId;

    } catch (error) {
      console.error('Error submitting form:', error);
      alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
  });
</script>
</body>
</html>