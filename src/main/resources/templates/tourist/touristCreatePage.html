<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>관광지 등록</title>

    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/recruit.css}">
    <link rel="stylesheet" th:href="@{/css/tourist.css}">

    <link rel="stylesheet" th:href="@{/css/touristCreateForm.css}">

    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8b23243ecce1d67f7d49784724586afa&libraries=services"></script>

</head>
<body>

<nav class="navbar" th:replace="~{navbar :: navbar}"></nav>

<div class="main-layout">

    <div class="map-container">
        <div class="recruit-page" id="map-page">
            <div class="recruit-header">
                <h1 class="recruit-title">카카오 맵</h1>
            </div>
            <div id="map-content">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <div class="content-container">
        <div class="recruit-page" id="create-page">

            <div class="form-page-header">
                <h1 class="form-page-title">관광지 등록</h1>
            </div>

            <form id="tourist-create-form"
                  action="/api/v1/tourist-spots"
                  method="post">

                <div class="form-group">
                    <input type="text" id="district" name="district" class="form-control"
                           placeholder="지역을 입력해주세요." required>
                </div>

                <div class="form-group">
                    <input type="text" id="title" name="title" class="form-control"
                           placeholder="여행지를 입력해주세요." required>
                </div>

                <div class="form-group">
                    <textarea id="description" name="description" class="form-control" rows="5"
                              placeholder="여행 설명을 입력해주세요."></textarea>
                </div>

                <div class="form-group">
                    <input type="text" class="form-control" id="map-address-display"
                           placeholder="지도위에 여행지 위치를 클릭해주세요." disabled>
                </div>
                <input type="hidden" id="address" name="address" value="주소 임시값">

                <div class="form-group">
                    <input type="text" id="phone" name="phone" class="form-control"
                           placeholder="전화번호를 입력해주세요.">
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit">Register</button>
                    <a href="/tourist/touristListPage" class="btn-cancel">Cancel</a>
                </div>
            </form>

        </div>
    </div>
</div>
<script th:src="@{/js/map.js}"></script>

<script th:src="@{/js/mapClickToAddress.js}"></script>

<script>
    document.getElementById('tourist-create-form').addEventListener('submit', function(event) {

        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);
        const actionUrl = form.action;

        fetch(actionUrl, {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('서버 응답이 올바르지 않습니다.');
            })
            .then(data => {
                alert(data.message);

                const newSpotId = data.data; // ex: 118
                window.location.href = '/layout/' + newSpotId;
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                alert('등록 중 오류가 발생했습니다: ' + error.message);
            });
    });
</script>
</body>
</html>